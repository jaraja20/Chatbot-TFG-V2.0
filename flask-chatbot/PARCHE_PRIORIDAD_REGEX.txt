"""
PARCHE: Priorizar Regex y Fuzzy sobre LLM cuando tienen buena confianza
Inserta DESPUÃ‰S de la lÃ­nea 824 (return intent_contexto, score_contexto)
"""

# AGREGARDESPUÃ‰S DE LA LÃNEA 824:

        # Si patrÃ³n tiene ALTA confianza (>0.85) y fuzzy estÃ¡ de acuerdo, priorizar sobre LLM
        if confianza_patron > 0.85 and intent_patron == intent_fuzzy and confianza_fuzzy >= 0.5:
            logger.info(f"ðŸŽ¯ Regex + Fuzzy en consenso (prioridad sobre LLM): {intent_patron} ({confianza_patron:.2f})")
            return intent_patron, confianza_patron
        
        # Si patrÃ³n tiene buena confianza (>0.80) Y es mejor que LLM, usarlo directamente
        if confianza_patron > 0.80 and (confianza_llm < 0.85 or intent_llm == 'nlu_fallback'):
            logger.info(f"ðŸŽ¯ Regex tiene buena confianza: {intent_patron} ({confianza_patron:.2f})")
            return intent_patron, confianza_patron
